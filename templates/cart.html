<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LegoBricks - –ö–æ—Ä–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <a href="{{ url_for('index') }}">
                    <img src="{{ url_for('static', filename='images/logo.png') }}" alt="LegoBricks" style="height: 50px;">
                </a>
            </div>
            <ul>
                <li><a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a></li>
                <li><a href="{{ url_for('catalog') }}">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                <li><a href="{{ url_for('about') }}">–û –Ω–∞—Å</a></li>
                <li><a href="{{ url_for('cart') }}" class="cart-icon">üõí <span id="cart-count">{{ cart|sum(attribute='quantity') }}</span></a></li>
            </ul>
        </nav>
    </header>

    <main>
        <h1>–ö–æ—Ä–∑–∏–Ω–∞</h1>

        {% if cart %}
        <div class="cart-container">
            <table class="cart-table">
                <thead>
                    <tr>
                        <th>–¢–æ–≤–∞—Ä</th>
                        <th>–¶–µ–Ω–∞</th>
                        <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                        <th>–°—É–º–º–∞</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in cart %}
                    <tr data-id="{{ item.id }}">
                        <td class="cart-product">
                            <img src="{{ url_for('static', filename='images/' + item.image) }}" alt="{{ item.name }}" style="width: 80px; height: 80px; object-fit: cover; border-radius: 10px;">
                            <span>{{ item.name }}</span>
                        </td>
                        <td>{{ item.price }} —Å—É–º</td>
                        <td>
                            <input type="number" class="cart-quantity" value="{{ item.quantity }}" min="1" style="width: 60px; padding: 5px;">
                        </td>
                        <td class="item-total">{{ item.total }} —Å—É–º</td>
                        <td>
                            <button class="btn-remove" style="background: none; border: none; color: #c41e3a; font-size: 1.2rem; cursor: pointer;">‚úñ</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <div class="cart-summary">
                <h3>–ò—Ç–æ–≥–æ: <span id="cart-total">{{ total }} —Å—É–º</span></h3>
                <button class="btn btn-large" id="checkout-btn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
                <button class="btn btn-outline" id="clear-cart-btn">–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
            </div>
        </div>

        <div id="checkout-form" style="display: none; margin-top: 40px;">
            <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
            <form id="order-form">
                <div style="margin-bottom: 15px;">
                    <label>–í–∞—à–µ –∏–º—è:</label><br>
                    <input type="text" name="name" required style="width: 100%; padding: 10px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label><br>
                    <input type="tel" name="phone" required style="width: 100%; padding: 10px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label>Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label><br>
                    <input type="email" name="email" style="width: 100%; padding: 10px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É:</label><br>
                    <textarea name="comment" rows="4" style="width: 100%; padding: 10px;"></textarea>
                </div>
                <button type="submit" class="btn btn-large">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
            </form>
        </div>

        {% else %}
        <div style="text-align: center; padding: 60px;">
            <p style="font-size: 1.5rem;">üõí –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
            <a href="{{ url_for('catalog') }}" class="btn" style="margin-top: 20px;">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
        </div>
        {% endif %}
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h4>LegoBricks</h4>
                <p>–ú–∞–≥–∞–∑–∏–Ω –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö LEGO-–∫–∏—Ä–ø–∏—á–µ–π –≤ –¢–∞—à–∫–µ–Ω—Ç–µ</p>
            </div>
            <div class="footer-section">
                <h4>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h4>
                <ul>
                    <li><a href="{{ url_for('index') }}">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li><a href="{{ url_for('catalog') }}">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                    <li><a href="{{ url_for('about') }}">–û –Ω–∞—Å</a></li>
                    <li><a href="{{ url_for('cart') }}">–ö–æ—Ä–∑–∏–Ω–∞</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
                <p>–≥. –¢–∞—à–∫–µ–Ω—Ç, –ú–∏—Ä–∑–æ-–£–ª—É–≥–±–µ–∫—Å–∫–∏–π —Ä–∞–π–æ–Ω, —É–ª. –ë–ò–ô 434</p>
                <p>–¢–µ–ª: +998910010013</p>
                <p>Email: info@legobricks.uz</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2026 LegoBricks. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
        </div>
    </footer>

    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
        document.querySelectorAll('.cart-quantity').forEach(input => {
            input.addEventListener('change', function() {
                const row = this.closest('tr');
                const id = parseInt(row.dataset.id);
                const quantity = parseInt(this.value);

                fetch('/api/cart/update', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({id: id, quantity: quantity})
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    }
                });
            });
        });

        // –£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
        document.querySelectorAll('.btn-remove').forEach(btn => {
            btn.addEventListener('click', function() {
                const row = this.closest('tr');
                const id = parseInt(row.dataset.id);

                fetch('/api/cart/update', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({id: id, quantity: 0})
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        location.reload();
                    }
                });
            });
        });

        // –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É
        document.getElementById('clear-cart-btn')?.addEventListener('click', function() {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É?')) {
                fetch('/api/cart/clear', {method: 'POST'})
                .then(() => location.reload());
            }
        });

        // –ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É –∑–∞–∫–∞–∑–∞
        document.getElementById('checkout-btn')?.addEventListener('click', function() {
            document.getElementById('checkout-form').style.display = 'block';
            this.style.display = 'none';
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–∞
        document.getElementById('order-form')?.addEventListener('submit', function(e) {
            e.preventDefault();

            alert('–°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');

            fetch('/api/cart/clear', {method: 'POST'})
                .then(() => {
                    window.location.href = "{{ url_for('catalog') }}";
                });
        });
    </script>
</body>
</html>